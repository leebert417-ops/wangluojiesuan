# 通风网络Hardy Cross迭代法求解器
## 使用说明

### 功能概述
本程序使用Hardy Cross迭代法求解通风网络各巷道风量。根据图5.2所示的通风网络拓扑，包含6个节点、8条巷道、3个回路。

### 算法原理
- **方法**: Hardy Cross迭代法
- **收敛判据**: 各回路残差均小于0.001
- **最大迭代次数**: 1000次
- **基本方程**:
  - 节点流量守恒: ΣQ = 0
  - 回路压降平衡: Σ(R×Q×|Q|) = 0

### 文件说明

#### 1. `ventilation_network_solver.m`
核心求解器函数，实现Hardy Cross迭代算法。

**输入参数**:
- `R`: 各巷道风阻向量 (1×8)，单位: N·s²/m⁸
- `Q_total`: 初始总风量，单位: m³/s

**输出参数**:
- `Q`: 各巷道风量 (1×8)，单位: m³/s
- `iterations`: 实际迭代次数

#### 2. `main_script.m`
主脚本，从CSV文件读取数据并求解。

**功能特性**:
- 从 `network_data.csv` 读取风阻数据
- 输出详细的求解结果和验证信息
- 自动保存结果到 `ventilation_results.csv`
- 生成完整的可视化图形（4个子图）
- 保存图像到 `ventilation_network_results.png`

**使用方法**:
```matlab
% 1. 编辑 network_data.csv 文件，设置各巷道风阻
% 2. （可选）在脚本第14行修改总风量 Q_total
% 3. 运行脚本
main_script
```

#### 3. `network_data.csv`
输入数据文件，包含各巷道风阻。

**格式**:
```
branch,resistance
1,0.1
2,0.2
...
```

### 网络拓扑说明

```
            6 (出口)
           /|\
          / | \
         7  8  \
        /   |   \
       5----6----4
      /|    |    |\
     / |    |    | \
    5  |   (II)  |  4
       |         |
       3----6----2
        \   |   /
         \  |  /
          3 2 1
           \|/
            1 (入口)
```

**节点定义**:
- 节点1: 入口
- 节点2: 左下分流点
- 节点3: 左上汇流点
- 节点4: 右上分流点
- 节点5: 右下汇流点
- 节点6: 出口

**巷道定义**:
- 巷道1: 节点1→节点2
- 巷道2: 节点2→节点3
- 巷道3: 节点1→节点3
- 巷道4: 节点4→节点5
- 巷道5: 节点3→节点5
- 巷道6: 节点4→节点6
- 巷道7: 节点5→节点6
- 巷道8: 节点6→节点1 (回流)

**回路定义**:
- 回路I: 巷道1-2-3
- 回路II: 巷道3-4-6-5
- 回路III: 巷道6-7-8

### 快速开始

#### 方式1: 使用主脚本（推荐）
```matlab
% 1. 编辑 network_data.csv 设置您的风阻值
% 2. （可选）修改 main_script.m 第14行的 Q_total
% 3. 运行脚本
main_script
```

**输出内容**:
- 控制台显示详细的求解过程和验证结果
- 自动保存 `ventilation_results.csv`（风量数据）
- 自动保存 `ventilation_network_results.png`（可视化图形）

#### 方式2: 自定义使用求解器
```matlab
% 定义风阻
R = [0.1, 0.2, 0.15, 0.25, 0.18, 0.22, 0.20, 0.12];
Q_total = 100;

% 求解
[Q, iterations] = ventilation_network_solver(R, Q_total);

% 查看结果
disp('各巷道风量:');
disp(Q);
```

### 输出结果说明

#### 控制台输出
- 输入参数信息
- 迭代收敛信息
- 各巷道风量和压降
- 节点流量守恒验证
- 回路压降平衡验证

#### 文件输出
- `ventilation_results.csv`: 各巷道风量数据表
- `ventilation_network_results.png`: 可视化结果图

#### 可视化图形

`main_script.m` 会生成包含4个子图的完整可视化结果：

1. **风量柱状图**: 显示各巷道风量大小
2. **压降柱状图**: 显示各巷道压力损失
3. **网络拓扑图**: 带标注的网络结构图
4. **求解信息**: 迭代次数和收敛状态

### 参数设置建议

#### 风阻 (R)
- 单位: N·s²/m⁸ 或 kg/m⁷
- 典型范围: 0.01 ~ 1.0
- 根据巷道长度、截面积、粗糙度计算

#### 总风量 (Q_total)
- 单位: m³/s
- 典型范围: 50 ~ 500 m³/s
- 根据矿井通风需求确定

### 验证方法

程序会自动验证以下条件:

1. **节点流量守恒**: 每个节点的流入量等于流出量
2. **回路压降平衡**: 每个回路的总压降为零
3. **收敛性检查**: 残差小于设定容差

### 注意事项

1. 确保所有风阻值为正数
2. 总风量应大于零
3. 若不收敛，可能需要:
   - 检查网络拓扑定义
   - 调整初始风量估计
   - 检查风阻数据合理性

### 故障排除

**问题**: 迭代不收敛
- **原因**: 风阻差异过大、网络拓扑错误
- **解决**: 检查风阻数据，验证网络定义

**问题**: 节点流量不守恒
- **原因**: 网络拓扑定义错误
- **解决**: 检查loops矩阵定义

**问题**: CSV文件读取失败
- **原因**: 文件格式错误
- **解决**: 检查CSV文件格式，确保有表头

### 扩展使用

如需修改网络拓扑，需要在 `ventilation_network_solver.m` 中修改以下部分:
1. 巷道数量和编号
2. 回路定义矩阵 `loops`
3. 初始风量估计

### 技术支持

如有问题，请检查:
1. MATLAB版本 (建议R2016b及以上)
2. 输入数据格式
3. 文件路径设置

---
**版本**: 1.0
**最后更新**: 2025-12-16
