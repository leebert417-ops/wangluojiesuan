# 03 数学/物理原理与推导

本项目把通风网络视作“类电路系统”，将**巷道风阻**类比电阻，将**风量**类比电流，将**节点压差**类比电势差，并在两类约束下求解：

- 节点守恒（基尔霍夫第一定律）：质量守恒
- 回路压降平衡（基尔霍夫第二定律）：能量守恒

---

## 1. Atkinson 阻力定律（巷道压降-风量关系）

对通风巷道（分支）：

1) 只考虑压降绝对值：

$$
\Delta p = R Q^2
$$

2) 考虑风流方向（便于计算与迭代）：

$$
\Delta p = R \,|Q|\,Q
$$

其中：
- $\Delta p$：分支压降（Pa）
- $Q$：分支风量（m$^3$/s），正负号表示相对于分支定义方向（`from_node -> to_node`）的流向
- $R$：风阻系数（正数）

---

## 2. 基尔霍夫第一定律：节点风量守恒

对任意节点 $i$：

$$
\sum Q_\text{in}(i) - \sum Q_\text{out}(i) = b_i
$$

其中 $b_i$ 表示边界注入（入风节点为正，回风节点为负，其他为 0）。

用节点-分支关联矩阵 $\mathbf{A}$ 表示：

$$
\mathbf{A}\mathbf{Q}=\mathbf{b}
$$

矩阵元素约定（与代码一致）：
- 若分支 $j$ 的起点为节点 $i$（流出），则 $A_{ij}=+1$
- 若分支 $j$ 的终点为节点 $i$（流入），则 $A_{ij}=-1$
- 否则 $A_{ij}=0$

---

## 3. 基尔霍夫第二定律：回路压降闭合

对任意闭合回路 $k$，沿回路方向遍历，各分支压降代数和为 0：

$$
\sum_{j \in loop_k} s_{kj}\Delta p_j = 0
$$

其中 $s_{kj}\in\{-1,0,+1\}$ 表示分支 $j$ 在回路 $k$ 中的方向关系：
- $+1$：分支方向与回路遍历方向一致
- $-1$：相反
- $0$：不在该回路中

用回路矩阵 $\mathbf{S}$ 表示：

$$
\mathbf{S}\Delta\mathbf{p} = \mathbf{0}
$$

---

## 4. “初始可行流”的意义（为什么要先满足节点守恒）

Hardy Cross 的经典做法是：
1) 先构造一个满足 $\mathbf{A}\mathbf{Q}^{(0)}=\mathbf{b}$ 的初始风量分布（节点守恒成立）
2) 再通过回路迭代修正，使 $\mathbf{S}\Delta\mathbf{p}=\mathbf{0}$ 成立

本项目在 `ventilation_network_solver_generic.m` 中采用“最小范数解”构造初始可行流（详见下一章算法实现）。

---

## 5. 约束与解的存在性（直观解释）

给定连通网络与边界注入向量 $\mathbf{b}$：
- 必须满足 $\sum_i b_i = 0$（总入风量等于总回风量），否则无解；
- 关联矩阵 $\mathbf{A}$ 的行向量线性相关（$\sum$ 行 = 0），因此常见做法是删去一行作为参考节点，避免奇异；
- 回路约束提供额外方程，使得风量分布收敛到满足能量守恒的物理解。

