stages:
  - pages

pages:
  image: node:22
  stage: pages
  rules:
    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
      changes:
        - document/**/*
        - .gitlab-ci.yml
    - when: never
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
      - document/node_modules/
  script:
    - cd document
    - npm ci
    # GitLab Pages 的站点路径通常为 /<namespace>/<project>/ （含 subgroup 时也会包含在内）
    - export VITEPRESS_BASE="/${CI_PROJECT_PATH}/"
    - npm run docs:build
    - cd ..
    - rm -rf public
    - cp -r document/.vitepress/dist public
  artifacts:
    paths:
      - public
    expire_in: 1 week